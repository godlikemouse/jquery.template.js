/*
 * Copyright 2014 Jason Graves (GodLikeMouse/Collaboradev)
 * http://www.collaboradev.com
 *
 * This file is part of jquery.template.js.
 *
 * The jquery.template.js plugin is free software: you can redistribute it
 * and/or modify it under the terms of the GNU General Public
 * License as published by the Free Software Foundation, either
 * version 3 of the License, or (at your option) any later version.
 *
 * The jquery.template.js plugin is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with the jquery.template.js plugin. If not, see http://www.gnu.org/licenses/.
 */
$.fn.template=function(options){var _ref=this,_element=$(this),_cache={},_placeholder=$("<p>"),engine={index:0},_defaultOptions={onBind:function(e){},onPreRender:function(e,t){},renderEmpty:!1};function parse(s,binding){function template(e,t){return t||(t=binding),_cache[e]||(_cache[e]=$(e).template()),_cache[e].bind(t)}if(s.indexOf("{")>=0&&s.indexOf("}")>=0){var tokens=s.match(/\{.*?\}/gm);for(var i in tokens){var token=tokens[i],source=token.replace("{","").replace("}",""),value=eval(source);if("object"==typeof value){s=value;break}s=s.replace(token,value)}}return s}function inspect(e,t){for(var n=0;n<e.length;n++){var r=$(e[n]),o=r.get(0).attributes;$(o).each(function(){var e=this.nodeName;options.onPreRender(this,t);var n=parse(this.value,t);if(this.value=n,e.indexOf("data-")>=0&&"object"==typeof n){var o=e.replace("data-","");r.data(o,n),r.removeAttr(e)}});for(var i=r.contents(),a=0;a<i.length;a++)options.onPreRender(i[a],t),inspect($(i[a]),t);if(1!==r.prop("nodeType")){options.onPreRender(r,t);var c=parse(r.text(),t);"object"==typeof c?r.replaceWith(c):r.replaceWith(_placeholder.html(c).html())}}return e}return options=$.extend(!0,_defaultOptions,options),_ref.bind=function(e){try{options.onBind(e),e||(e=[]);var t=$("<p>");$(e).each(function(e){var n=_element.html(),r=n.match(/style\=".*\{.*?\}?"/gm);for(var o in r)n=n.replace(r[o],parse(r[o],this));engine.index=e,t.append(inspect($(n),this))}),void 0!=e&&0!=e.length||options.renderEmpty&&t.append(_element.html())}catch(e){console.error("Error in jquery.template.js at bind: "+e,_ref)}return t.children()},_ref.toString=function(){return _element.html()},_ref};
